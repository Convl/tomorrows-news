<<<<<<< HEAD
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Tomorrow's News</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/css/custom.css" rel="stylesheet">
</head>

<body class="bg-grey-50">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">Tomorrow's News</a>

            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle"></i> <span id="userEmail">Loading...</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" id="logoutBtn">
                                <i class="bi bi-box-arrow-right"></i> Logout
                            </a></li>
                    </ul>
                </div>
=======
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tomorrow's News</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/app/assets/theme.css" rel="stylesheet" />
    <script type="module">
        import { getToken } from '/app/js/config.js';
        try {
            if (getToken()) window.location.replace('/app/dashboard.html');
        } catch { }
    </script>
</head>

<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
        <div class="container">
            <a class="navbar-brand text-primary" href="/app/">Tomorrow's News</a>
            <div class="d-flex ms-auto">
                <a class="btn btn-outline-primary me-2" href="/app/login.html">Login</a>
                <a class="btn btn-primary" href="/app/register.html">Register</a>
>>>>>>> 55ed622
            </div>
        </div>
    </nav>

<<<<<<< HEAD
    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="h3 fw-bold text-dark">Your Topics</h1>
                        <p class="text-taupe mb-0">Monitor news and events from your topics of interest</p>
                    </div>
                    <a href="topics/create.html" class="btn btn-primary">
                        <i class="bi bi-plus-lg"></i> New Topic
                    </a>
                </div>
            </div>
        </div>

        <!-- Topics Grid -->
        <div class="row" id="topicsContainer">
            <!-- Loading state -->
            <div class="col-12 text-center py-5" id="loadingState">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="text-muted mt-3">Loading your topics...</p>
            </div>

            <!-- Empty state -->
            <div class="col-12 text-center py-5 d-none" id="emptyState">
                <i class="bi bi-folder2-open text-muted" style="font-size: 3rem;"></i>
                <h4 class="mt-3 text-muted">No topics yet</h4>
                <p class="text-muted">Create your first topic to start monitoring news and events</p>
                <a href="topics/create.html" class="btn btn-primary">
                    <i class="bi bi-plus-lg"></i> Create Topic
                </a>
            </div>

            <!-- Verification required state -->
            <div class="col-12 text-center py-5 d-none" id="verificationState">
                <div class="card mx-auto" style="max-width: 400px;">
                    <div class="card-body p-4">
                        <div class="text-warning mb-3">
                            <i class="bi bi-envelope-exclamation" style="font-size: 3rem;"></i>
                        </div>
                        <h4 class="fw-bold text-dark">Email Verification Required</h4>
                        <p class="text-muted mb-4">
                            Please verify your email address to access your topics and start monitoring news.
                        </p>
                        <div class="d-grid gap-2">
                            <button type="button" class="btn btn-primary" id="sendVerificationBtn">
                                Send Verification Email
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="api.logout()">
                                Logout
                            </button>
=======
    <main class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <div class="card shadow-sm">
                    <div class="card-body p-4">
                        <h1 class="h4 mb-3">Welcome</h1>
                        <p class="text-secondary">Track upcoming events for your topics of interest. Please login or
                            create an account to continue.</p>
                        <div class="d-grid gap-2">
                            <a class="btn btn-primary" href="/app/login.html">Login</a>
                            <a class="btn btn-outline-primary" href="/app/register.html">Create account</a>
>>>>>>> 55ed622
                        </div>
                    </div>
                </div>
            </div>
        </div>
<<<<<<< HEAD
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            // Check authentication
            if (!requireAuth()) return;

            try {
                // Load user info and topics
                await loadUserInfo();
                await loadTopics();
            } catch (error) {
                showToast('Failed to load dashboard data', 'danger');
            }
        });

        async function loadUserInfo() {
            try {
                const user = await api.get('/users/me');
                document.getElementById('userEmail').textContent = user.email;
            } catch (error) {
                console.error('Failed to load user info:', error);
            }
        }

        async function loadTopics() {
            try {
                const topics = await api.get('/topics');
                displayTopics(topics);
            } catch (error) {
                document.getElementById('loadingState').classList.add('d-none');

                if (error.message === 'EMAIL_NOT_VERIFIED') {
                    showVerificationRequired();
                } else {
                    showToast('Failed to load topics', 'danger');
                }
            }
        }

        function displayTopics(topics) {
            const container = document.getElementById('topicsContainer');
            const loadingState = document.getElementById('loadingState');
            const emptyState = document.getElementById('emptyState');

            loadingState.classList.add('d-none');

            if (topics.length === 0) {
                emptyState.classList.remove('d-none');
                return;
            }

            // Clear container
            container.innerHTML = '';

            topics.forEach(topic => {
                const topicCard = createTopicCard(topic);
                container.appendChild(topicCard);
            });
        }

        function createTopicCard(topic) {
            const col = document.createElement('div');
            col.className = 'col-12 col-md-6 col-lg-4 mb-4';

            col.innerHTML = `
                <div class="card topic-card h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title fw-bold text-dark">${escapeHtml(topic.name)}</h5>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="dropdown">
                                    <i class="bi bi-three-dots"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="topics/edit.html?id=${topic.id}">
                                        <i class="bi bi-pencil"></i> Edit
                                    </a></li>
                                    <li><a class="dropdown-item" href="topics/edit.html?id=${topic.id}">
                                        <i class="bi bi-plus-circle"></i> Add Source
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item text-danger" href="#" onclick="deleteTopic(${topic.id})">
                                        <i class="bi bi-trash"></i> Delete
                                    </a></li>
                                </ul>
                            </div>
                        </div>
                        
                        ${topic.description ? `<p class="card-text text-muted">${escapeHtml(topic.description)}</p>` : ''}
                        
                        <div class="d-flex flex-wrap gap-1 mb-3">
                            ${topic.keywords ? topic.keywords.split(',').slice(0, 3).map(keyword =>
                `<span class="badge bg-light text-dark">${escapeHtml(keyword.trim())}</span>`
            ).join('') : ''}
                        </div>
                        
                        <div class="row text-center small text-muted">
                            <div class="col">
                                <div class="fw-medium">${topic.source_count || 0}</div>
                                <div>Sources</div>
                            </div>
                            <div class="col">
                                <div class="fw-medium">${topic.event_count || 0}</div>
                                <div>Events</div>
                            </div>
                            <div class="col">
                                <div class="fw-medium">${topic.is_active ? 'Active' : 'Inactive'}</div>
                                <div>Status</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            return col;
        }

        async function deleteTopic(topicId) {
            if (!confirm('Are you sure you want to delete this topic? This action cannot be undone.')) {
                return;
            }

            try {
                await api.delete(`/topics/${topicId}`);
                showToast('Topic deleted successfully', 'success');
                await loadTopics(); // Reload topics
            } catch (error) {
                showToast('Failed to delete topic', 'danger');
            }
        }

        function showVerificationRequired() {
            document.getElementById('verificationState').classList.remove('d-none');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Handle verification email sending
        document.getElementById('sendVerificationBtn').addEventListener('click', async function () {
            const stopLoading = showLoading(this);

            try {
                // Get current user email
                const user = await api.get('/users/me');

                await api.post('/auth/request-verify-token', {
                    email: user.email
                });

                showToast('Verification email sent! Please check your inbox and click the verification link.', 'success');

            } catch (error) {
                showToast('Failed to send verification email: ' + error.message, 'danger');
            } finally {
                stopLoading();
            }
        });
    </script>
=======
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
>>>>>>> 55ed622
</body>

</html>