<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>New Topic ‚Ä¢ Tomorrow's News</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/app/assets/theme.css" rel="stylesheet" />
</head>

<body class="bg-light">
    <main class="container py-5">
        <div class="main-container">
            <a href="/app/dashboard.html" class="btn btn-link mb-4">‚Üê Back</a>
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-4">
                        <div class="icon-placeholder icon-topic me-3">üìö</div>
                        <h1 class="h4 mb-0 fw-semibold">Create Topic</h1>
                    </div>
                    <div id="alert" class="alert d-none" role="alert"></div>
                    <div id="form"></div>
                    <div class="d-grid gap-2 mt-4">
                        <button id="submit" class="btn btn-primary">Create Topic</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script type="module" src="/app/js/config.js"></script>
    <script type="module" src="/app/js/choices.js"></script>
    <script type="module" src="/app/js/field-help.js"></script>
    <script type="module">
        import { apiBase, authHeaders, getToken } from '/app/js/config.js';
        import { populateSelect } from '/app/js/choices.js';
        import { addHelpIcon, addHelpText, HELP_TEXTS } from '/app/js/field-help.js';
        const alertEl = document.getElementById('alert');
        if (!getToken()) { window.location.href = '/app/login.html'; }
        const formRoot = document.getElementById('form');
        formRoot.innerHTML = `
            <div class="mb-4">
              <label class="form-label" for="name">üìù Name <span class="text-secondary">(required)</span></label>
              <input class="form-control" id="name" required placeholder="e.g., Law & Legislation in Germany" />
            </div>
            <div class="mb-4">
              <label class="form-label" for="description">üìÑ Description</label>
              <textarea class="form-control" id="description" rows="4" placeholder="Describe what kinds of events you are interested in..."></textarea>
            </div>
        `;
        const submitBtn = document.getElementById('submit');
        async function init() {
            // Initialize help system
            setupFieldHelp();
        }

        function setupFieldHelp() {
            // Add help icons for topic fields
            addHelpIcon('label[for="name"]', 'A succinct name for the topic about which upcoming events shall be gathered, e.g. "Law & Legislation in Germany", "International developments in artificial intelligence", "Anything and everything having to do with UFOS". The value in this field will be passed to the LLM that assists in the event extraction, and will directly impact the results that you see in your dashboard.');

            addHelpIcon('label[for="description"]', 'A more detailed description of the topic and the kinds of events you are interested in, e.g.: "Court cases and legislative proceedings in Germany that are significant enough to be of interest to the general public", "Only focus on A.I. developments that are likely to impact the job market for software engineers within the next 12 months", "I particularly care about UFO- and Alien-related Festivals and conventions". The value in this field will be passed to the LLM that assists in the event extraction, and will directly impact the results that you see in your dashboard');
        }
        submitBtn.onclick = async () => {
            alertEl.className = 'alert d-none';
            const payload = {
                name: document.getElementById('name').value.trim(),
                description: document.getElementById('description').value.trim() || null,
                is_active: true, // Always set to active
            };
            if (!payload.name) {
                alertEl.textContent = 'Name is required';
                alertEl.className = 'alert alert-danger';
                return;
            }
            try {
                const resp = await fetch(`${apiBase}/topics/`, { method: 'POST', headers: authHeaders(), body: JSON.stringify(payload) });
                if (!resp.ok) throw new Error('Failed to create topic');
                window.location.href = '/app/dashboard.html';
            } catch (err) {
                alertEl.textContent = err.message || 'Failed to create topic';
                alertEl.className = 'alert alert-danger';
            }
        };
        init();
    </script>
</body>

</html>