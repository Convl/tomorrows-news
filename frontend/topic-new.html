<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>New Topic ‚Ä¢ Tomorrow's News</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="/frontend/assets/theme.css" rel="stylesheet" />
    <style>
        .custom-tooltip {
            position: absolute;
            background: #333;
            color: white;
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 14px;
            line-height: 1.4;
            max-width: 400px;
            z-index: 1050;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            white-space: pre-line;
            display: none;
        }
        .custom-tooltip::before {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border: 5px solid transparent;
            border-top-color: #333;
        }
        .tooltip-trigger {
            position: relative;
        }
    </style>
</head>

<body class="bg-light">
    <main class="container py-5">
        <div class="main-container">
            <a href="dashboard.html" class="btn btn-link mb-4">‚Üê Back</a>
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-4">
                        <div class="icon-placeholder icon-topic me-3">üìö</div>
                        <h1 class="h4 mb-0 fw-semibold">Create Topic</h1>
                    </div>
                    <div id="alert" class="alert d-none" role="alert"></div>
                    <div id="form"></div>
                    <div class="d-grid gap-2 mt-4">
                        <button id="submit" class="btn btn-primary">Create Topic</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script type="module" src="/frontend/js/config.js"></script>
    <script type="module" src="/frontend/js/choices.js"></script>
    <script type="module">
        import { apiBase, authHeaders, getToken } from '/frontend/js/config.js';
        import { populateSelect } from '/frontend/js/choices.js';
        const alertEl = document.getElementById('alert');
        if (!getToken()) { window.location.href = 'auth/login.html'; }
        const formRoot = document.getElementById('form');
        formRoot.innerHTML = `
            <div class="mb-4">
              <label class="form-label" for="name">üìù Name <span class="text-secondary">(required)</span> 
                <span class="text-info ms-1 tooltip-trigger" data-tooltip="A succinct name for the topic about which upcoming events shall be gathered, e.g. 'Law & Legislation in Germany', 'International developments in artificial intelligence', 'Anything and everything having to do with UFOS'. The value in this field will be passed to the LLM that assists in the event extraction, and will directly impact the results that you see in your dashboard." style="cursor: help;">‚ÑπÔ∏è</span>
              </label>
              <input class="form-control" id="name" required placeholder="e.g., Law & Legislation in Germany" />
            </div>
            <div class="mb-4">
              <label class="form-label" for="description">üìÑ Description 
                <span class="text-info ms-1 tooltip-trigger" data-tooltip="A more detailed description of the topic and the kinds of events you are interested in, e.g.: 'Court cases and legislative proceedings in Germany that are significant enough to be of interest to the general public', 'Only focus on A.I. developments that are likely to impact the job market for software engineers within the next 12 months', 'I particularly care about UFO- and Alien-related Festivals and conventions'. The value in this field will be passed to the LLM that assists in the event extraction, and will directly impact the results that you see in your dashboard." style="cursor: help;">‚ÑπÔ∏è</span>
              </label>
              <textarea class="form-control" id="description" rows="4" placeholder="Describe what kinds of events you are interested in..."></textarea>
            </div>
        `;
        const submitBtn = document.getElementById('submit');
        async function init() {
            // Initialize custom tooltips
            initCustomTooltips();
        }
        submitBtn.onclick = async () => {
            alertEl.className = 'alert d-none';
            const payload = {
                name: document.getElementById('name').value.trim(),
                description: document.getElementById('description').value.trim() || null,
                is_active: true, // Always set to active
            };
            if (!payload.name) {
                alertEl.textContent = 'Name is required';
                alertEl.className = 'alert alert-danger';
                return;
            }
            try {
                const resp = await fetch(`${apiBase}/topics/`, { method: 'POST', headers: authHeaders(), body: JSON.stringify(payload) });
                if (!resp.ok) throw new Error('Failed to create topic');
                window.location.href = 'dashboard.html';
            } catch (err) {
                alertEl.textContent = err.message || 'Failed to create topic';
                alertEl.className = 'alert alert-danger';
            }
        };
        init();
        
        // Custom tooltip functionality
        function initCustomTooltips() {
            const tooltipTriggers = document.querySelectorAll('.tooltip-trigger');
            let currentTooltip = null;
            
            tooltipTriggers.forEach(trigger => {
                trigger.addEventListener('mouseenter', function(e) {
                    // Remove any existing tooltip
                    if (currentTooltip) {
                        currentTooltip.remove();
                    }
                    
                    // Create new tooltip
                    const tooltip = document.createElement('div');
                    tooltip.className = 'custom-tooltip';
                    tooltip.textContent = this.getAttribute('data-tooltip');
                    document.body.appendChild(tooltip);
                    currentTooltip = tooltip;
                    
                    // Position tooltip
                    const rect = this.getBoundingClientRect();
                    tooltip.style.left = (rect.left + rect.width / 2 - tooltip.offsetWidth / 2) + 'px';
                    tooltip.style.top = (rect.top - tooltip.offsetHeight - 8) + 'px';
                    tooltip.style.display = 'block';
                });
                
                trigger.addEventListener('mouseleave', function() {
                    if (currentTooltip) {
                        currentTooltip.remove();
                        currentTooltip = null;
                    }
                });
            });
        }
    </script>
</body>

</html>